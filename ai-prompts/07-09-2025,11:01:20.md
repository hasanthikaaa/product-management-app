PROMPT: Aws sqs configuration setup and code samples for send message, receive message, and delete message

RESPONSE: 

Great question 👍 Let’s go step by step on **AWS SQS setup** and then I’ll give you **Node.js + TypeScript code samples** for **Send, Receive, Delete messages** using the **AWS SDK v3**.

---

# 🔧 1. AWS SQS Configuration Setup

1. **Create an SQS Queue**

    * Go to AWS Console → SQS → *Create Queue*
    * Choose **Standard** (or FIFO if strict ordering is needed)
    * Set a name (e.g., `product-events-queue`)
    * Configure visibility timeout, retention, etc.
    * Save.

2. **Get Queue URL and ARN**

    * After creation, copy:

        * **Queue URL** (needed for API calls)
        * **Queue ARN** (needed for IAM policies)

3. **IAM Permissions**

    * The IAM role/user running your app must have these permissions:

      ```json
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "sqs:SendMessage",
              "sqs:ReceiveMessage",
              "sqs:DeleteMessage",
              "sqs:GetQueueAttributes"
            ],
            "Resource": "arn:aws:sqs:us-east-1:123456789012:product-events-queue"
          }
        ]
      }
      ```

---

# 📦 2. Install Dependencies

```bash
npm install @aws-sdk/client-sqs
```

---

# 📝 3. SQS Client Setup

`src/sqsClient.ts`

```ts
import { SQSClient } from "@aws-sdk/client-sqs";

export const sqsClient = new SQSClient({
  region: "us-east-1", // change to your region
});
```

---

# 🚀 4. Send Message

```ts
import { SendMessageCommand } from "@aws-sdk/client-sqs";
import { sqsClient } from "./sqsClient";

const QUEUE_URL = process.env.SQS_QUEUE_URL || "https://sqs.us-east-1.amazonaws.com/123456789012/product-events-queue";

export const sendMessage = async () => {
  try {
    const params = {
      QueueUrl: QUEUE_URL,
      MessageBody: JSON.stringify({
        eventType: "PRODUCT_CREATED",
        productId: "p123",
        sellerId: "s1",
        timestamp: new Date().toISOString(),
      }),
    };

    const result = await sqsClient.send(new SendMessageCommand(params));
    console.log("✅ Message sent, ID:", result.MessageId);
  } catch (err) {
    console.error("❌ Error sending message:", err);
  }
};
```

---

# 📥 5. Receive Message

```ts
import { ReceiveMessageCommand } from "@aws-sdk/client-sqs";
import { sqsClient } from "./sqsClient";

const QUEUE_URL = process.env.SQS_QUEUE_URL || "https://sqs.us-east-1.amazonaws.com/123456789012/product-events-queue";

export const receiveMessages = async () => {
  try {
    const params = {
      QueueUrl: QUEUE_URL,
      MaxNumberOfMessages: 5, // up to 10
      WaitTimeSeconds: 10,    // long polling
    };

    const result = await sqsClient.send(new ReceiveMessageCommand(params));
    if (result.Messages && result.Messages.length > 0) {
      result.Messages.forEach(msg => {
        console.log("📨 Received message:", msg.Body);
      });
      return result.Messages;
    } else {
      console.log("⚠️ No messages available");
      return [];
    }
  } catch (err) {
    console.error("❌ Error receiving messages:", err);
  }
};
```

---

# 🗑️ 6. Delete Message

```ts
import { DeleteMessageCommand } from "@aws-sdk/client-sqs";
import { sqsClient } from "./sqsClient";

const QUEUE_URL = process.env.SQS_QUEUE_URL || "https://sqs.us-east-1.amazonaws.com/123456789012/product-events-queue";

export const deleteMessage = async (receiptHandle: string) => {
  try {
    const params = {
      QueueUrl: QUEUE_URL,
      ReceiptHandle: receiptHandle,
    };

    await sqsClient.send(new DeleteMessageCommand(params));
    console.log("✅ Message deleted");
  } catch (err) {
    console.error("❌ Error deleting message:", err);
  }
};
```

---

# 🔄 7. Example Workflow

```ts
(async () => {
  await sendMessage();
  const messages = await receiveMessages();

  if (messages && messages.length > 0) {
    for (const msg of messages) {
      if (msg.ReceiptHandle) {
        await deleteMessage(msg.ReceiptHandle);
      }
    }
  }
})();
```

---

✅ Now you have a **complete SQS setup with TypeScript**:

* **Send** → push product events
* **Receive** → poll messages
* **Delete** → confirm processing

---

Do you want me to also show you how to **connect SQS with your Product API events** (e.g., sending a message automatically after a product is created/updated in your Express app)?
