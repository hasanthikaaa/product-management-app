PROMPT:
nodejs + express app listens for sqs messages example

RESPONSE:

Great question 👍 — you want a **Node.js + Express server** that also **listens for SQS messages**.
Typically, Express is used for handling HTTP requests, and AWS SDK (or `sqs-consumer`) is used for consuming messages from an **SQS queue**.

Here’s a simple working example using [`sqs-consumer`](https://www.npmjs.com/package/sqs-consumer):

---

### 1. Install dependencies

```bash
npm install express aws-sdk sqs-consumer
```

---

### 2. `server.js`

```js
import express from "express";
import { Consumer } from "sqs-consumer";
import AWS from "aws-sdk";
import dotenv from "dotenv";

dotenv.config();

const app = express();
app.use(express.json());

// configure AWS SDK
AWS.config.update({
  region: process.env.AWS_REGION || "us-east-1",
  accessKeyId: process.env.AWS_ACCESS_KEY_ID,
  secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,
});

// SQS queue URL
const QUEUE_URL = process.env.SQS_QUEUE_URL;

// create SQS consumer
const consumer = Consumer.create({
  queueUrl: QUEUE_URL,
  handleMessage: async (message) => {
    console.log("✅ Received SQS message:", message.Body);

    // do something with the message
    // e.g., save to DB, trigger business logic
  },
  sqs: new AWS.SQS(),
});

// error handling
consumer.on("error", (err) => {
  console.error("SQS consumer error:", err.message);
});

consumer.on("processing_error", (err) => {
  console.error("SQS processing error:", err.message);
});

// start consuming
consumer.start();

// Example Express route
app.get("/", (req, res) => {
  res.send("🚀 Express app + SQS consumer running!");
});

const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log(`HTTP server running on port ${PORT}`);
});
```

---

### 3. `.env`

```
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-key-id
AWS_SECRET_ACCESS_KEY=your-secret-key
SQS_QUEUE_URL=https://sqs.us-east-1.amazonaws.com/123456789012/your-queue
```

---

### 🔹 How this works

* Express handles **API requests** (e.g., `/` route).
* `sqs-consumer` runs in the same Node process and **polls messages** from SQS in the background.
* Every time a message arrives, `handleMessage` runs.
* Both run independently — Express doesn’t block SQS polling.

---

👉 Do you want me to also show you an example where **Express provides an API to send messages to the same SQS queue**, so you can test full flow (produce + consume)?
